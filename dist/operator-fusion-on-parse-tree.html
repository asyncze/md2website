<html lang='en'><head><link rel='icon' href='fav.png'><title>Operator Fusion on Parse Tree</title><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'><meta name='author' content='Michael Sjöberg'><meta name='description' content='My projects, posts, and programming notes.'><meta name='theme-color' content='#161716'><meta name='application-name' content='Michael Sjöberg'><meta name='apple-mobile-web-app-title' content='Operator Fusion on Parse Tree'><meta name='apple-mobile-web-app-capable' content='yes'><meta name='mobile-web-app-capable' content='yes'><meta name='apple-mobile-web-app-status-bar-style' content='#161716'><link rel='stylesheet' href='main.min.css'><script src='main.min.js'></script></head><body><nav><p><a href="index.html">home</a> <a href="journal.html">journal</a> <a href="projects.html">projects</a> <a href="posts.html">posts</a> <a href="programming.html">programming</a></p></nav><div class='page'><h1>Operator Fusion on Parse Tree</h1>
<p><em>July 2023</em> <a href="programming.html#python">Python</a> <a href="programming.html#python-compilers">Compilers</a></p>
<p>Operator fusion is a technique to combine or rearrange consecutive operations in a parse tree to improve efficiency of code execution. It is a common optimization technique used in compilers.</p>
<pre><code class="language-python">def simplify_parse_tree(tree):
    if (isinstance(tree, tuple)):
        # first value in tuple, remaining values in tuple
        operator, *operands = tree
        operands = [simplify_parse_tree(operand) for operand in operands]

        if all(isinstance(operand, int) for operand in operands):
            if operator == '+':
                return sum(operands)
            elif operator == '*':
                return eval('*'.join(map(str, operands)))

    return tree
</code></pre>
<pre><code class="language-python"># (1 + 2) * (3 + 4)
parse_tree = ('*', ('+', 1, 2), ('+', 3, 4))
print(simplify_parse_tree(parse_tree))
# 21

compiled = compile('(1 + 2) * (3 + 4)', '&lt;string&gt;', 'eval')
print(compiled.co_consts[0])
# 21
</code></pre>
<pre><code class="language-python">assert simplify_parse_tree(parse_tree) == compiled.co_consts[0]
</code></pre></div><div id='footer'><p>[<a id='invert'>light|dark</a>]</p><p class='small'>DOM loaded in <span id='dom_time'></span>, page loaded in <span id='load_time'></span>. <a href='https://github.com/mixmaester/md2html'>Static website built with md2html</a></p></div><script>hljs.highlightAll();</script></body></html>